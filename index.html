<!DOCTYPE html>
<html>

<head>
  <title>Grid Plugin</title>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="./src/styles/index.css">
  <link rel="stylesheet" href="./src/dbgridjs/styles/dbgrid.css">
</head>

<body>
  <div id="app">
    <div id="grdClient">
    </div>

    <!-- <button id="btnAddItem">
      Add Item to grdCustom
    </button> -->
    <div id="grdCustom">
    </div>

    <div id="grdConfig">
    </div>

    <div id="grdCeption">
    </div>
  </div>
  <!-- remove jquery if fetch, async/await is implemented -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="./src/scripts/extension.js"></script>
  <script src="./src/scripts/polyfill.js"></script>
  <script src="./src/dbgridjs/dbgrid.js"></script>
  <script>
      //let exposeMe = null;
      let grdClient = null;
      // let grdCustom = null;
      // let grdConfig = null;
      // let grdCeption = null;

      (function () {
        // Instance DBGrid Obj
        grdClient = new DBGrid({
          wrapper: "#grdClient",
          dataKeyNames: "ID",
          allowPaging: false,
          columns: [
            // { type: "checkbox", hideColumn: false, autoCheck: false },
            { fieldName: "ID", fieldHeader: "Key", fieldWidth: 0, displayOrder: 1, hideField: true, isDataKeyField: true, fieldType: "number" },
            { fieldName: "SEQUENCE", fieldHeader: "Sequence", fieldWidth: 110, displayOrder: 2, hideField: false, isDataKeyField: false, fieldType: "number" },
            { fieldName: "ITEM_DESC", fieldHeader: "Description", fieldWidth: 115, displayOrder: 3, hideField: false, isDataKeyField: false, fieldType: "string" },
            { fieldName: "DATE", fieldHeader: "Date Created", fieldWidth: 10, displayOrder: 4, hideField: false, isDataKeyField: false, fieldType: "date" }
          ],
          rowData: [
            [1, 1, "A", new Date("02/01/20")],
            [2, 1, "B", new Date("02/02/20")],
            [3, 1, "B", new Date("02/01/20")],
            [4, 2, "C", new Date("02/01/20")],
            [5, 2, "C", new Date("02/02/20")],
            [6, 2, "A", new Date("02/03/20")],
            [4, 3, "A", new Date("02/01/20")],
            [5, 3, "A", new Date("02/02/20")],
            [6, 3, "A", new Date("02/03/20")]
          ]
        });

        // grdCustom = new DBGrid({
        //   wrapper: "#grdCustom",
        //   dataKeyNames: "KEY",
        //   emptyDataText: "Click button to add item.",
        //   width: 220,
        //   //cancelSelectOnClick: true,
        //   columns: [
        //     { type: "checkbox", hideColumn: false, autoCheck: true },
        //     //{ type: "toggle", hideColumn: true, autoOpen: true },
        //     { fieldName: "KEY", fieldHeader: "Key", fieldWidth: 100, displayOrder: 1, hideField: true, isDataKeyField: true },
        //     { fieldName: "ITEM_NUMBER", fieldHeader: "Item #", fieldWidth: 100, displayOrder: 2, hideField: false, isDataKeyField: false },
        //     { fieldName: "ITEM_DESC", fieldHeader: "Description", fieldWidth: 100, displayOrder: 3, hideField: false, isDataKeyField: false },
        //   ],
        //   rowData: []
        // });

        // grdConfig = new DBGrid({
        //   wrapper: "#grdConfig",
        //   gridName: "DBGRIDJS_ITEMS",
        //   dataKeyNames: "EVIDENCE_CONTROL_NUMBER",
        //   columns: [
        //     { type: "checkbox", hideColumn: false, autoCheck: true }
        //   ],
        //   events: {
        //     toggle: function (row, contentRow, sender, event) {
        //       const td = contentRow.querySelector("td");

        //       td.appendChild(document.createTextNode("toggle-row"));
        //     }
        //   }
        // });

        // grdCeption = new DBGrid({
        //   wrapper: "#grdCeption",
        //   gridName: "DBGRIDJS_ASSIGNMENT",
        //   dataKeyNames: "ID,CASE_NUM,SECTION,PRIORITY",
        //   hiddenFields: "0,1,2", // field index
        //   pageSize: 5,
        //   cancelSelectOnClick: true,
        //   columns: [
        //     { type: "toggle", hideColumn: true, autoOpen: false }
        //   ],
        //   events: {
        //     toggle: function (row, contentRow, sender, event) {
        //       const grid = this;

        //       const td = contentRow.querySelector("td");
        //       const div = td.querySelector("div")
        //         ? td.querySelector("div")
        //         : document.createElement("div");
        //       let dbgridChild = div.querySelector("table");

        //       // Create child grid
        //       if (!dbgridChild) {
        //         dbgridChild = new DBGrid({
        //           wrapper: div,
        //           gridName: "DBGRIDJS_WORK",
        //           dataKeyNames: "ID",
        //           hiddenFields: "ID",
        //           additionalCriteria: "SECTION = '" + row.dataset["SECTION"] + "'",
        //           cancelSelectOnClick: true,
        //           pageSize: 5,
        //           columns: [
        //             { type: "checkbox" }
        //           ],
        //           events: {
        //             columnCreated: function (sender) {
        //               const parentGrid = grdCeption;
        //               const dataHolder = parentGrid.table.tHead.children[0];
        //               const row = sender.parent(".toggle-row");
        //               const dataFromParent = dataHolder.dataset["DATA"]
        //                 ? JSON.parse(dataHolder.dataset["DATA"])
        //                 : [];

        //               dataFromParent.forEach(function (data) {
        //                 const primaryKeyValue = data.primaryKey;
        //                 const selectedKeys = data.selectedKeys;

        //                 const rowPrimaryKey = row.dataset[parentGrid.options.primaryKeyName];

        //                 if (rowPrimaryKey === primaryKeyValue) {

        //                   const table = row.querySelector(".tableception");
        //                   const checkboxAll = table.tHead.querySelector("th input[type=checkbox]");

        //                   // Save to checkbox header
        //                   checkboxAll.dataset["SELECTED_KEYS"] = selectedKeys;
        //                 }
        //               });
        //             },
        //             checkAll: function (sender, event) {
        //               const grid = this;
        //               const parentGrid = grdCeption;
        //               const toggleRow = sender.parent("tr.toggle-row");

        //               const dataHolder = parentGrid.table.tHead.children[0];
        //               const data = dataHolder.dataset["DATA"]
        //                 ? JSON.parse(dataHolder.dataset["DATA"])
        //                 : [];
        //               const selectedKeys = grid.row.getSelectedKeys.call(grid);
        //               const primaryKeyValue = toggleRow.dataset[parentGrid.options.primaryKeyName];
        //               const rowDataFoundIndex = data.findIndex(function (rowData) {
        //                 return rowData.primaryKey === primaryKeyValue;
        //               });

        //               if (rowDataFoundIndex > -1) {
        //                 data.splice(rowDataFoundIndex, 1);
        //               }

        //               if (selectedKeys.length) {
        //                 data.push({
        //                   primaryKey: primaryKeyValue,
        //                   selectedKeys: selectedKeys
        //                 });
        //               }

        //               dataHolder.dataset["DATA"] = JSON.stringify(data);
        //             },
        //             check: function (checkboxAll, row, sender, event) {
        //               const grid = this;
        //               const parentGrid = grdCeption;
        //               const toggleRow = checkboxAll.parent("tr.toggle-row");

        //               const dataHolder = parentGrid.table.tHead.children[0];
        //               const data = dataHolder.dataset["DATA"]
        //                 ? JSON.parse(dataHolder.dataset["DATA"])
        //                 : [];
        //               const selectedKeys = grid.row.getSelectedKeys.call(grid);
        //               const primaryKeyValue = toggleRow.dataset[parentGrid.options.primaryKeyName];
        //               const rowDataFoundIndex = data.findIndex(function (rowData) {
        //                 return rowData.primaryKey === primaryKeyValue;
        //               });

        //               if (rowDataFoundIndex > -1) {
        //                 data.splice(rowDataFoundIndex, 1);
        //               }

        //               if (selectedKeys.length) {
        //                 data.push({
        //                   primaryKey: primaryKeyValue,
        //                   selectedKeys: selectedKeys
        //                 });
        //               }

        //               dataHolder.dataset["DATA"] = JSON.stringify(data);
        //             }
        //           }
        //         });

        //         dbgridChild.table.classList.add("tableception"); // header index issue fix
        //         dbgridChild.table.width = "100%";
        //         div.appendChild(dbgridChild.table);
        //         div.classList.add("toggleWrapper");
        //         div.classList.add("dbgridjs"); // manually add this for child grids
        //         td.appendChild(div);
        //       }
        //     },
        //   }
        // });

        //btnAddItem.addEventListener("click", addItem);

        function addItem() {
          let cell = [-1, 1, "Item"];

          cell[0] = grdCustom.rowData.length + 1;
          cell[1] = grdCustom.rowData.length + 1;

          grdCustom.addRow(cell);//.select();
        }

        // // Test multi sort
        // let array = [
        //   [1,1,"A"],
        //   [1,1,"B"],
        //   [1,3,"C"],
        //   [2,1,"A"],
        //   [2,1,"B"],
        //   [2,3,"C"],
        // ];

        // sort("0 DESC,1 DESC,2 ASC");

        // function sort(sortOrder) {
        //   sort = sortOrder.split(",");
        //   sort.reverse().map((sortName, currIndex) => {
        //     const index = sortName.split(" ")[0];
        //     const order = sortName.split(" ")[1];
            
        //     // asc
        //     if (order === "ASC") {
        //       array.sort((a, b) => {
        //         if (typeof a[index] === "number") {
        //           return a[index] - b[index];
        //         } else {
        //           return a[index].localeCompare(b[index]);
        //         }
        //       });
        //     }

        //     // desc
        //     if (order === "DESC") {
        //       array.sort((a, b) => {
        //         if (typeof a[index] === "number") {
        //           return b[index] - a[index];
        //         } else {
        //           return b[index].localeCompare(a[index]);
        //         }
        //       });
        //     }
        //   });

        //   console.log(array);
        // }
      }());
  </script>
</body>

</html>